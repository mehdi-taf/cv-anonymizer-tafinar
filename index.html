<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV Anonymizer - TAFINAR</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Header Application */
        .app-header {
            background: linear-gradient(135deg, #004199 0%, #0056cc 100%);
            padding: 25px 0;
            color: white;
            box-shadow: 0 4px 20px rgba(0, 65, 153, 0.3);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .app-logo {
            height: 60px;
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .app-logo img {
            height: 100%;
            width: auto;
        }

        .header-text h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header-text p {
            font-size: 16px;
            opacity: 0.9;
        }

        /* Main Container */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }

        /* Sections */
        .section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(0, 65, 153, 0.1);
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            color: #004199;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-title::before {
            content: "";
            width: 5px;
            height: 24px;
            background: linear-gradient(180deg, #004199 0%, #00bf63 100%);
            border-radius: 3px;
        }

        /* Upload Zone avec option image */
        .upload-zone {
            border: 3px dashed #004199;
            border-radius: 15px;
            padding: 50px 30px;
            text-align: center;
            background: rgba(0, 65, 153, 0.03);
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 25px;
        }

        .upload-zone:hover, .upload-zone.dragover {
            border-color: #00bf63;
            background: rgba(0, 191, 99, 0.08);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 191, 99, 0.2);
        }

        .upload-icon {
            font-size: 60px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .upload-text {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 500;
        }

        .upload-formats {
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
        }

        .upload-options {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .upload-btn {
            padding: 12px 20px;
            border: 2px solid #004199;
            background: white;
            color: #004199;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-btn:hover {
            background: #004199;
            color: white;
        }

        .upload-btn.image-mode {
            border-color: #00bf63;
            color: #00bf63;
        }

        .upload-btn.image-mode:hover {
            background: #00bf63;
            color: white;
        }

        .file-input {
            display: none;
        }

        /* Zone de texte optimisée */
        .cv-text-input {
            width: 100%;
            min-height: 400px;
            max-height: 600px;
            padding: 20px;
            border: 2px solid #e8ecf4;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            resize: vertical;
            margin-bottom: 25px;
            transition: all 0.3s ease;
            background: #fafbfc;
            overflow-y: auto;
        }

        .cv-text-input:focus {
            outline: none;
            border-color: #004199;
            background: white;
            box-shadow: 0 0 0 4px rgba(0, 65, 153, 0.1);
        }

        .char-counter {
            text-align: right;
            font-size: 12px;
            color: #666;
            margin-bottom: 20px;
        }

        /* Form Fields */
        .form-grid {
            display: grid;
            gap: 20px;
            margin-bottom: 25px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .form-label.required::after {
            content: " *";
            color: #dc3545;
        }

        .form-input {
            padding: 15px;
            border: 2px solid #e8ecf4;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: #fafbfc;
        }

        .form-input:focus {
            outline: none;
            border-color: #004199;
            background: white;
            box-shadow: 0 0 0 3px rgba(0, 65, 153, 0.1);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        /* Buttons */
        .btn {
            padding: 18px 35px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #004199 0%, #0056cc 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 65, 153, 0.4);
            width: 100%;
            font-size: 18px;
            padding: 20px;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 65, 153, 0.5);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: linear-gradient(135deg, #00bf63 0%, #00d66c 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 191, 99, 0.4);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 191, 99, 0.5);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
            transform: translateY(-2px);
        }

        /* Preview Section - Format A4 */
        .cv-preview {
            border: 2px solid #e8ecf4;
            border-radius: 12px;
            background: white;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 794px; /* A4 width en pixels à 96 DPI */
            margin: 0 auto;
        }

        /* CV Container - Format A4 exact */
        .cv-container {
            width: 794px; /* A4 width */
            min-height: 1123px; /* A4 height */
            background: white;
            font-size: 11pt; /* Police 11 comme demandé */
            line-height: 1.4;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0 auto;
            position: relative;
        }

        .cv-header {
            background: linear-gradient(135deg, #004199 0%, #0056cc 100%);
            padding: 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
        }

        .cv-logo-container {
            background: white;
            padding: 10px 12px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .cv-logo-container img {
            height: 35px;
            width: auto;
        }

        .cv-profile-info {
            text-align: center;
            flex: 1;
            margin-left: 30px;
        }

        .cv-job-title {
            font-size: 16pt;
            font-weight: 700;
            margin-bottom: 6px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .cv-profile-code {
            font-size: 12pt;
            font-weight: 700;
            color: #00ff7f;
            background: rgba(0, 255, 127, 0.15);
            padding: 4px 12px;
            border-radius: 15px;
            display: inline-block;
            border: 1px solid rgba(0, 255, 127, 0.3);
        }

        .cv-content {
            padding: 25px 30px;
            background: white;
        }

        /* Sections CV avec couleurs exactes */
        .cv-section {
            margin-bottom: 25px;
            page-break-inside: avoid;
        }

        .cv-section-title {
            background: #004199; /* Bleu exact */
            color: white; /* Blanc sur bleu */
            padding: 8px 20px;
            font-size: 12pt;
            font-weight: 700;
            text-align: center;
            text-transform: uppercase;
            border-radius: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0, 65, 153, 0.2);
            letter-spacing: 0.5px;
        }

        .cv-experience {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #004199;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
        }

        .cv-job-position {
            color: #004199; /* Bleu pour les postes */
            font-weight: 700;
            font-size: 11pt;
            margin-bottom: 6px;
            line-height: 1.3;
        }

        .cv-job-details {
            color: #00bf63; /* Vert pour dates/lieu */
            font-size: 10pt;
            font-weight: 600;
            margin-bottom: 12px;
            background: rgba(0, 191, 99, 0.1);
            padding: 3px 8px;
            border-radius: 10px;
            display: inline-block;
            border: 1px solid rgba(0, 191, 99, 0.2);
        }

        .cv-subcategory {
            color: #000; /* Noir gras pour sous-catégories */
            font-weight: 700;
            font-size: 11pt;
            margin: 10px 0 8px 0;
        }

        .cv-missions {
            margin: 8px 0;
        }

        .cv-missions ul {
            margin: 0;
            padding-left: 18px;
        }

        .cv-missions li {
            margin-bottom: 6px;
            font-size: 11pt;
            line-height: 1.4;
            color: #000; /* Noir pour le texte */
            text-align: justify;
        }

        .cv-competence-category {
            margin-bottom: 15px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-top: 3px solid #004199;
        }

        .cv-competence-title {
            font-weight: 700;
            color: #004199;
            margin-bottom: 10px;
            font-size: 11pt;
        }

        .cv-competence-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .cv-competence-item {
            background: white;
            color: #000;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 10pt;
            border: 1px solid #e0e0e0;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .cv-formation-item {
            margin-bottom: 12px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #00bf63;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
        }

        .cv-formation-title {
            font-weight: 700;
            color: #004199;
            font-size: 11pt;
            margin-bottom: 4px;
        }

        .cv-formation-details {
            color: #00bf63;
            font-size: 10pt;
            font-weight: 600;
        }

        .cv-simple-list ul {
            margin: 0;
            padding-left: 18px;
        }

        .cv-simple-list li {
            margin-bottom: 6px;
            font-size: 11pt;
            color: #000;
            line-height: 1.4;
        }

        /* Messages */
        .message {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
            font-weight: 500;
        }

        .message.show {
            display: block;
        }

        .message-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .message-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
            cursor: pointer;
        }

        /* Actions */
        .actions {
            display: none;
            gap: 15px;
            margin-top: 25px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .actions.show {
            display: flex;
        }

        /* Internal Info */
        .internal-info {
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin-top: 25px;
        }

        .info-grid {
            display: grid;
            gap: 10px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #004199;
            font-size: 13px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
        }

        .info-label {
            font-weight: 600;
            color: #004199;
        }

        .info-value {
            color: #333;
            font-style: italic;
        }

        /* Loading */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loading-content {
            background: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 400px;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #004199;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: #333;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .loading-subtext {
            color: #666;
            font-size: 14px;
        }

        /* Styles d'impression A4 parfaits */
        @media print {
            body * {
                visibility: hidden;
            }
            
            .cv-preview, .cv-preview * {
                visibility: visible;
            }
            
            .cv-preview {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
                border: none;
                border-radius: 0;
                box-shadow: none;
                max-width: none;
            }
            
            .cv-container {
                width: 210mm; /* A4 width exact */
                min-height: 297mm; /* A4 height exact */
                margin: 0;
                box-shadow: none;
            }
            
            .cv-header {
                border-radius: 0;
                page-break-inside: avoid;
            }
            
            .cv-section {
                page-break-inside: avoid;
            }
            
            .cv-section-title {
                page-break-after: avoid;
            }
            
            .cv-experience {
                page-break-inside: avoid;
            }
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 1fr;
                max-width: 900px;
            }
            
            .cv-container {
                width: 100%;
                max-width: 794px;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }

            .main-container {
                padding: 20px 15px;
                gap: 25px;
            }

            .section {
                padding: 20px;
            }

            .cv-text-input {
                min-height: 300px;
            }

            .cv-header {
                flex-direction: column;
                text-align: center;
                gap: 15px;
                padding: 15px 20px;
            }

            .cv-profile-info {
                margin-left: 0;
            }

            .upload-options {
                flex-direction: column;
            }

            .actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
            
            .cv-container {
                font-size: 10pt;
                padding: 0 10px;
            }
            
            .cv-content {
                padding: 20px 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="app-header">
        <div class="header-content">
            <div class="app-logo">
                <img src="https://image.jimcdn.com/app/cms/image/transf/dimension=400x10000:format=png/path/sff9eaf88e82d8f8a/image/ifdd007cf2d2293e3/version/1616433262/image.png" alt="TAFINAR">
            </div>
            <div class="header-text">
                <h1>CV Anonymizer</h1>
                <p>Anonymisation professionnelle avec traitement image</p>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Input Section -->
        <div class="section">
            <div class="section-title">CV à traiter</div>
            
            <!-- Upload Zone avec options -->
            <div class="upload-zone" id="uploadZone">
                <div class="upload-icon">📄</div>
                <div class="upload-text">Glissez-déposez votre CV ou sélectionnez une option</div>
                <div class="upload-formats">PDF, DOC, DOCX ou IMAGE (PNG, JPG)</div>
                
                <div class="upload-options">
                    <button class="upload-btn" id="textBtn">📄 Extraire le texte</button>
                    <button class="upload-btn image-mode" id="imageBtn">🖼️ Traiter comme image</button>
                </div>
                
                <input type="file" id="fileInput" class="file-input" accept=".pdf,.doc,.docx">
                <input type="file" id="imageInput" class="file-input" accept="image/*,.pdf">
            </div>

            <div style="text-align: center; margin: 20px 0; color: #666; font-weight: 600; font-size: 16px;">OU</div>

            <!-- Text Input -->
            <textarea 
                id="cvTextInput" 
                class="cv-text-input" 
                placeholder="Collez ici le texte de votre CV...

Si votre CV est mal formaté après copier-coller, utilisez l'option 'Traiter comme image' ci-dessus.

EXEMPLE :
================

SOFREN | Lyon | Janvier 2024 - présent
INGÉNIEUR ENVIRONNEMENT
Mission chez EDF | CNPE Saint-Alban | Avril 2024 - Juin 2025
• Rédaction du Rapport Environnemental Annuel 2024
• Proposition d'améliorations dans le processus de réalisation du REA
• Élaboration du Bulletin d'Information Environnement

INGÉNIEUR D'ÉTUDES ENVIRONNEMENT ET RISQUE CONVENTIONNEL
Mission chez EDVANCE | Lyon | Janvier 2024 - Janvier 2025
CHIMIE
• Réalisation d'études de risque incendie
• Études environnementales selon la norme ISO 14001

FORMATION
Master Génie des Procédés | INSA Lyon | 2020-2022

COMPÉTENCES
• AutoCAD, SolidWorks
• Analyse de risques
• ISO 14001

================
Continuez avec tout votre CV..."></textarea>

            <div class="char-counter" id="charCounter">0 caractères</div>

            <!-- Form Fields -->
            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label required">Poste recherché</label>
                    <input type="text" id="jobTitle" class="form-input" placeholder="Ex: Ingénieur Environnement Senior" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Code profil (optionnel)</label>
                    <input type="text" id="profileCode" class="form-input" placeholder="Ex: ABC (généré automatiquement si vide)">
                </div>

                <div class="form-group">
                    <label class="form-label">Disponibilité</label>
                    <input type="text" id="availability" class="form-input" placeholder="Ex: Immédiate, 2 mois de préavis...">
                </div>

                <div class="form-group">
                    <label class="form-label">Mobilité géographique</label>
                    <input type="text" id="mobility" class="form-input" placeholder="Ex: France entière, Région Lyonnaise...">
                </div>

                <div class="form-group">
                    <label class="form-label">Prétention salariale</label>
                    <input type="text" id="salary" class="form-input" placeholder="Ex: 45-55k€, À négocier...">
                </div>

                <div class="form-group">
                    <label class="form-label">Remarques générales</label>
                    <textarea id="remark" class="form-input form-textarea" placeholder="Remarques sur le profil, points forts..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Notes pour Soufyane</label>
                    <textarea id="soufyaneRemark" class="form-input form-textarea" placeholder="Notes internes, commentaires stratégiques..."></textarea>
                </div>
            </div>

            <!-- Generate Button -->
            <button type="button" id="generateBtn" class="btn btn-primary">
                <span>Analyser et générer le CV anonyme</span>
            </button>

            <!-- Messages -->
            <div id="successMessage" class="message message-success">
                CV anonyme généré avec succès ! Format A4 optimisé.
            </div>
            <div id="errorMessage" class="message message-error">
                Erreur lors de la génération. Vérifiez les données ou réessayez.
            </div>
            <div id="apiKeyMessage" class="message message-info">
                Cliquez ici pour configurer votre clé API et utiliser l'outil.
            </div>
        </div>

        <!-- Preview Section -->
        <div class="section">
            <div class="section-title">Aperçu CV anonyme (Format A4)</div>
            
            <div id="cvPreview" class="cv-preview">
                <div class="cv-container">
                    <div class="cv-header">
                        <div class="cv-logo-container">
                            <img src="https://image.jimcdn.com/app/cms/image/transf/dimension=400x10000:format=png/path/sff9eaf88e82d8f8a/image/ifdd007cf2d2293e3/version/1616433262/image.png" alt="TAFINAR">
                        </div>
                        <div class="cv-profile-info">
                            <div class="cv-job-title" id="previewJobTitle">Poste à définir</div>
                            <div class="cv-profile-code" id="previewProfileCode">PROFIL XXX</div>
                        </div>
                    </div>
                    <div class="cv-content">
                        <div id="previewContent">
                            <div style="text-align: center; color: #666; padding: 50px 20px;">
                                <p style="font-size: 14pt; margin-bottom: 15px;">L'aperçu du CV anonyme apparaîtra ici</p>
                                <p style="font-size: 12pt; margin-bottom: 10px;">Format A4 - Police 11pt</p>
                                <p style="font-size: 11pt; color: #999;">Fournissez un CV et cliquez sur "Analyser"</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div id="previewActions" class="actions">
                <button type="button" id="downloadBtn" class="btn btn-success">
                    Télécharger PDF
                </button>
                <button type="button" id="printBtn" class="btn btn-primary">
                    Imprimer
                </button>
                <button type="button" id="modifyBtn" class="btn btn-secondary">
                    Modifier
                </button>
            </div>

            <!-- Internal Info -->
            <div id="internalInfo" class="internal-info">
                <div class="section-title">Informations sauvegardées</div>
                <div id="infoGrid" class="info-grid"></div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">Analyse en cours...</div>
            <div class="loading-subtext">Traitement du CV par l'IA</div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        // Configuration IA avec vision
        const AI_CONFIG = {
            apiUrl: 'https://openrouter.ai/api/v1/chat/completions',
            apiKey: '',
            textModel: 'anthropic/claude-3.5-sonnet',
            visionModel: 'anthropic/claude-3.5-sonnet' // Même modèle avec vision
        };

        // Variables globales
        let currentCvData = null;
        let processingMode = 'text'; // 'text' ou 'image'

        // Elements DOM
        const uploadZone = document.getElementById('uploadZone');
        const textBtn = document.getElementById('textBtn');
        const imageBtn = document.getElementById('imageBtn');
        const fileInput = document.getElementById('fileInput');
        const imageInput = document.getElementById('imageInput');
        const cvTextInput = document.getElementById('cvTextInput');
        const generateBtn = document.getElementById('generateBtn');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const cvPreview = document.getElementById('cvPreview');
        const previewActions = document.getElementById('previewActions');
        const successMessage = document.getElementById('successMessage');
        const errorMessage = document.getElementById('errorMessage');
        const apiKeyMessage = document.getElementById('apiKeyMessage');
        const internalInfo = document.getElementById('internalInfo');
        const charCounter = document.getElementById('charCounter');

        // Event Listeners
        textBtn.addEventListener('click', () => {
            processingMode = 'text';
            fileInput.click();
        });

        imageBtn.addEventListener('click', () => {
            processingMode = 'image';
            imageInput.click();
        });

        uploadZone.addEventListener('dragover', handleDragOver);
        uploadZone.addEventListener('dragleave', handleDragLeave);
        uploadZone.addEventListener('drop', handleDrop);
        
        fileInput.addEventListener('change', (e) => handleFileSelect(e, 'text'));
        imageInput.addEventListener('change', (e) => handleFileSelect(e, 'image'));
        
        generateBtn.addEventListener('click', generateAnonymousCV);
        document.getElementById('downloadBtn').addEventListener('click', downloadPDF);
        document.getElementById('printBtn').addEventListener('click', printCV);
        document.getElementById('modifyBtn').addEventListener('click', enableModification);
        apiKeyMessage.addEventListener('click', showApiKeyPrompt);

        cvTextInput.addEventListener('input', updateCharCounter);
        cvTextInput.addEventListener('input', debounceAutoSave);

        // Auto-save
        const formInputs = ['jobTitle', 'profileCode', 'availability', 'mobility', 'salary', 'remark', 'soufyaneRemark'];
        formInputs.forEach(id => {
            document.getElementById(id).addEventListener('input', debounceAutoSave);
        });

        function updateCharCounter() {
            const count = cvTextInput.value.length;
            charCounter.textContent = `${count.toLocaleString()} caractères`;
        }

        let autoSaveTimeout;
        function debounceAutoSave() {
            clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(autoSave, 2000);
        }

        function autoSave() {
            const formData = collectFormData();
            localStorage.setItem('cv_anonymizer_data', JSON.stringify(formData));
        }

        function collectFormData() {
            return {
                cvText: cvTextInput.value,
                jobTitle: document.getElementById('jobTitle').value,
                profileCode: document.getElementById('profileCode').value,
                availability: document.getElementById('availability').value,
                mobility: document.getElementById('mobility').value,
                salary: document.getElementById('salary').value,
                remark: document.getElementById('remark').value,
                soufyaneRemark: document.getElementById('soufyaneRemark').value,
                timestamp: new Date().toISOString()
            };
        }

        // Drag & Drop handlers
        function handleDragOver(e) {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                // Auto-detect si c'est une image
                const file = files[0];
                if (file.type.startsWith('image/')) {
                    processingMode = 'image';
                    processFile(file, 'image');
                } else {
                    processingMode = 'text';
                    processFile(file, 'text');
                }
            }
        }

        function handleFileSelect(e, mode) {
            const file = e.target.files[0];
            if (file) {
                processFile(file, mode);
            }
        }

        // File processing
        async function processFile(file, mode) {
            try {
                showLoading(`${mode === 'image' ? 'Analyse image' : 'Extraction texte'}...`, 'Traitement en cours');
                
                if (mode === 'image') {
                    await processImageFile(file);
                } else {
                    await processTextFile(file);
                }
                
            } catch (error) {
                hideLoading();
                showMessage('error', 'Erreur traitement : ' + error.message);
            }
        }

        async function processTextFile(file) {
            let text = '';
            
            if (file.type === 'application/pdf') {
                text = await extractTextFromPDF(file);
            } else if (file.type.includes('word') || file.name.endsWith('.docx') || file.name.endsWith('.doc')) {
                text = await extractTextFromWord(file);
            } else {
                throw new Error('Format non supporté pour extraction texte');
            }

            cvTextInput.value = text;
            updateCharCounter();
            hideLoading();
            showMessage('success', `Texte extrait avec succès ! ${text.length.toLocaleString()} caractères.`);
        }

        async function processImageFile(file) {
            // Convertir l'image en base64
            const base64 = await fileToBase64(file);
            
            // Analyser directement l'image avec l'IA vision
            const extractedText = await analyzeImageCV(base64, file.type);
            
            cvTextInput.value = extractedText;
            updateCharCounter();
            hideLoading();
            showMessage('success', 'CV analysé depuis l\'image avec succès !');
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => {
                    const base64 = reader.result.split(',')[1];
                    resolve(base64);
                };
                reader.onerror = error => reject(error);
            });
        }

        // Analyse d'image CV avec IA vision
        async function analyzeImageCV(base64Image, mimeType) {
            if (!AI_CONFIG.apiKey) {
                throw new Error('Clé API requise');
            }

            const prompt = `Tu analyses cette image de CV. Ton objectif est d'extraire TOUT le texte visible en préservant la structure et l'organisation.

RÈGLES D'EXTRACTION :
1. Extrait TOUT le texte visible, même les petits détails
2. Préserve l'ordre et la structure originale
3. Identifie les sections (expériences, formations, compétences, etc.)
4. Garde les dates, lieux, entreprises, missions exactement comme écrit
5. N'invente RIEN, n'ajoute RIEN qui ne soit pas visible
6. Structure le texte de manière lisible

Réponds avec le texte complet extrait de l'image, bien structuré et lisible.`;

            try {
                const response = await fetch(AI_CONFIG.apiUrl, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${AI_CONFIG.apiKey}`,
                        'Content-Type': 'application/json',
                        'HTTP-Referer': window.location.origin
                    },
                    body: JSON.stringify({
                        model: AI_CONFIG.visionModel,
                        messages: [
                            {
                                role: 'system',
                                content: 'Tu es un expert en extraction de texte depuis des images de CV. Tu extrais tout le texte visible sans rien modifier ni ajouter.'
                            },
                            {
                                role: 'user',
                                content: [
                                    {
                                        type: 'text',
                                        text: prompt
                                    },
                                    {
                                        type: 'image_url',
                                        image_url: {
                                            url: `data:${mimeType};base64,${base64Image}`
                                        }
                                    }
                                ]
                            }
                        ],
                        max_tokens: 4000,
                        temperature: 0.1
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Erreur API vision ${response.status}: ${errorText}`);
                }

                const data = await response.json();
                return data.choices[0].message.content;

            } catch (error) {
                throw new Error('Erreur analyse image : ' + error.message);
            }
        }

        // PDF text extraction
        async function extractTextFromPDF(file) {
            return new Promise(async (resolve, reject) => {
                try {
                    pdfjsLib.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
                    
                    const arrayBuffer = await file.arrayBuffer();
                    const pdf = await pdfjsLib.getDocument({
                        data: arrayBuffer,
                        verbosity: 0
                    }).promise;
                    
                    let fullText = '';
                    const totalPages = pdf.numPages;

                    for (let i = 1; i <= totalPages; i++) {
                        const page = await pdf.getPage(i);
                        const textContent = await page.getTextContent();
                        
                        const pageText = textContent.items
                            .map(item => item.str)
                            .join(' ')
                            .replace(/\s+/g, ' ')
                            .trim();
                        
                        if (pageText) {
                            fullText += pageText + '\n\n';
                        }
                    }

                    resolve(fullText.trim());
                } catch (error) {
                    reject(error);
                }
            });
        }

        async function extractTextFromWord(file) {
            throw new Error('Extraction Word non disponible. Utilisez l\'option image ou copiez-collez le texte.');
        }

        // Génération CV anonyme avec structure EXACTE
        async function generateAnonymousCV() {
            const cvText = cvTextInput.value.trim();
            const jobTitle = document.getElementById('jobTitle').value.trim();

            if (!cvText) {
                showMessage('error', 'Veuillez fournir le contenu du CV');
                return;
            }

            if (!jobTitle) {
                showMessage('error', 'Veuillez saisir le poste recherché');
                return;
            }

            if (!AI_CONFIG.apiKey) {
                showMessage('info', 'Cliquez ici pour configurer votre clé API');
                return;
            }

            try {
                showLoading('Analyse et anonymisation...', 'Structuration avec vos couleurs exactes');
                
                const analysisResult = await analyzeAndStructureCV(cvText);
                
                if (analysisResult) {
                    const profileCode = document.getElementById('profileCode').value.trim() || generateProfileCode();

                    currentCvData = {
                        jobTitle: jobTitle,
                        profileCode: profileCode,
                        anonymizedContent: analysisResult,
                        originalLength: cvText.length,
                        processedAt: new Date().toISOString()
                    };

                    localStorage.setItem('cv_anonymizer_generated', JSON.stringify(currentCvData));
                    
                    displayAnonymousCV();
                    displayInternalInfo();
                    showMessage('success', 'CV anonyme généré avec mise en forme professionnelle !');
                } else {
                    throw new Error('Erreur lors de l\'analyse');
                }

            } catch (error) {
                showMessage('error', 'Erreur : ' + error.message);
            } finally {
                hideLoading();
            }
        }

        // IA Analysis avec structure PARFAITE
        async function analyzeAndStructureCV(cvText) {
            const prompt = `Tu es un expert en anonymisation et structuration de CV. Ta mission :

1. ANONYMISATION : Supprimer UNIQUEMENT nom, prénom, email, téléphone, adresse personnelle
2. PRÉSERVATION TOTALE : Garder EXACTEMENT tout le contenu professionnel 
3. STRUCTURATION : Organiser selon l'ordre OBLIGATOIRE

ORDRE DES SECTIONS OBLIGATOIRE :
1. EXPÉRIENCES PROFESSIONNELLES (en premier)
2. COMPÉTENCES  
3. FORMATIONS
4. Autres sections (langues, centres d'intérêt, etc.)

SUPPRESSION OBLIGATOIRE :
- Toutes les introductions type "Profil professionnel", "À propos", "Présentation"
- Nom, prénom, email, téléphone, adresse personnelle

RÈGLES STRICTES :
- Ne résume JAMAIS, ne raccourcis JAMAIS
- Garde chaque mot des expériences et missions
- Préserve toutes les dates, lieux, entreprises
- Garde toutes les formations détaillées
- Conserve toutes les compétences listées

FORMAT DE RÉPONSE JSON :
{
  "experiences": [
    {
      "poste": "poste exact",
      "entreprise": "entreprise exacte", 
      "dates": "dates exactes",
      "lieu": "lieu exact",
      "subcategory": "sous-catégorie si elle existe ou null",
      "missions": ["mission 1 exacte", "mission 2 exacte"]
    }
  ],
  "competences": ["compétence 1", "compétence 2"],
  "formations": [
    {
      "diplome": "diplôme exact",
      "etablissement": "établissement exact",
      "dates": "dates exactes",
      "lieu": "lieu exact"
    }
  ],
  "autres_sections": {
    "langues": ["langue 1", "langue 2"],
    "centres_interet": ["centre 1", "centre 2"]
  }
}

CV à traiter :
${cvText}`;

            try {
                const response = await fetch(AI_CONFIG.apiUrl, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${AI_CONFIG.apiKey}`,
                        'Content-Type': 'application/json',
                        'HTTP-Referer': window.location.origin
                    },
                    body: JSON.stringify({
                        model: AI_CONFIG.textModel,
                        messages: [
                            {
                                role: 'system', 
                                content: 'Tu es un expert en CV. Tu structures selon l\'ordre exact demandé et préserves tout le contenu professionnel. Tu réponds UNIQUEMENT en JSON valide.'
                            },
                            {
                                role: 'user',
                                content: prompt
                            }
                        ],
                        max_tokens: 8000,
                        temperature: 0.05
                    })
                });

                if (!response.ok) {
                    throw new Error(`Erreur API ${response.status}`);
                }

                const data = await response.json();
                const content = data.choices[0].message.content;
                
                const cleanJson = content.replace(/```json/g, '').replace(/```/g, '').trim();
                const parsedData = JSON.parse(cleanJson);
                
                return generateCVHTML(parsedData);

            } catch (error) {
                console.error('Erreur IA:', error);
                throw error;
            }
        }

        // Génération HTML avec couleurs EXACTES
        function generateCVHTML(data) {
            let html = '';

            // 1. EXPÉRIENCES PROFESSIONNELLES (obligatoirement en premier)
            if (data.experiences && data.experiences.length > 0) {
                html += `
                    <div class="cv-section">
                        <div class="cv-section-title">Expériences Professionnelles</div>
                `;
                
                data.experiences.forEach(exp => {
                    html += `<div class="cv-experience">`;
                    
                    // Poste en bleu gras
                    if (exp.entreprise) {
                        html += `<div class="cv-job-position">${exp.entreprise} - ${exp.poste}</div>`;
                    } else {
                        html += `<div class="cv-job-position">${exp.poste}</div>`;
                    }
                    
                    // Dates/lieu en vert
                    let details = [];
                    if (exp.dates) details.push(exp.dates);
                    if (exp.lieu) details.push(exp.lieu);
                    if (details.length > 0) {
                        html += `<div class="cv-job-details">${details.join(' | ')}</div>`;
                    }
                    
                    // Sous-catégorie en noir gras si elle existe
                    if (exp.subcategory) {
                        html += `<div class="cv-subcategory">${exp.subcategory}</div>`;
                    }
                    
                    // Missions avec puces
                    if (exp.missions && exp.missions.length > 0) {
                        html += `<div class="cv-missions"><ul>`;
                        exp.missions.forEach(mission => {
                            html += `<li>${mission}</li>`;
                        });
                        html += `</ul></div>`;
                    }
                    
                    html += `</div>`;
                });
                
                html += `</div>`;
            }

            // 2. COMPÉTENCES
            if (data.competences && data.competences.length > 0) {
                html += `
                    <div class="cv-section">
                        <div class="cv-section-title">Compétences</div>
                        <div class="cv-competence-category">
                            <div class="cv-competence-list">
                `;
                data.competences.forEach(comp => {
                    html += `<span class="cv-competence-item">${comp}</span>`;
                });
                html += `
                            </div>
                        </div>
                    </div>
                `;
            }

            // 3. FORMATIONS
            if (data.formations && data.formations.length > 0) {
                html += `
                    <div class="cv-section">
                        <div class="cv-section-title">Formations</div>
                `;
                
                data.formations.forEach(formation => {
                    html += `<div class="cv-formation-item">`;
                    html += `<div class="cv-formation-title">${formation.diplome}</div>`;
                    
                    let details = [];
                    if (formation.dates) details.push(formation.dates);
                    if (formation.etablissement) details.push(formation.etablissement);
                    if (formation.lieu) details.push(formation.lieu);
                    
                    if (details.length > 0) {
                        html += `<div class="cv-formation-details">${details.join(' | ')}</div>`;
                    }
                    html += `</div>`;
                });
                
                html += `</div>`;
            }

            // 4. AUTRES SECTIONS
            if (data.autres_sections) {
                Object.entries(data.autres_sections).forEach(([sectionName, items]) => {
                    if (items && items.length > 0) {
                        const titleFormatted = sectionName.charAt(0).toUpperCase() + sectionName.slice(1).replace(/_/g, ' ');
                        html += `
                            <div class="cv-section">
                                <div class="cv-section-title">${titleFormatted}</div>
                                <div class="cv-simple-list">
                                    <ul>
                        `;
                        items.forEach(item => {
                            html += `<li>${item}</li>`;
                        });
                        html += `
                                    </ul>
                                </div>
                            </div>
                        `;
                    }
                });
            }

            return html;
        }

        function displayAnonymousCV() {
            if (currentCvData) {
                document.getElementById('previewJobTitle').textContent = currentCvData.jobTitle;
                document.getElementById('previewProfileCode').textContent = `PROFIL ${currentCvData.profileCode}`;
                document.getElementById('previewContent').innerHTML = currentCvData.anonymizedContent;
                previewActions.classList.add('show');
            }
        }

        function generateProfileCode() {
            const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            return Array.from({length: 3}, () => letters[Math.floor(Math.random() * letters.length)]).join('');
        }

        function displayInternalInfo() {
            const formData = collectFormData();
            const data = {
                'Poste recherché': formData.jobTitle || 'Non spécifié',
                'Code profil': currentCvData?.profileCode || 'Non généré',
                'Disponibilité': formData.availability || 'Non spécifiée',
                'Mobilité': formData.mobility || 'Non spécifiée',
                'Prétention salariale': formData.salary || 'Non spécifiée',
                'Remarque': formData.remark || 'Aucune',
                'Notes pour Soufyane': formData.soufyaneRemark || 'Aucune',
                'Mode traitement': processingMode === 'image' ? 'Analyse d\'image' : 'Extraction texte',
                'Traité le': currentCvData ? new Date(currentCvData.processedAt).toLocaleString('fr-FR') : 'N/A'
            };

            let html = '';
            Object.entries(data).forEach(([label, value]) => {
                html += `
                    <div class="info-item">
                        <span class="info-label">${label} :</span>
                        <span class="info-value">${value}</span>
                    </div>
                `;
            });

            document.getElementById('infoGrid').innerHTML = html;
            internalInfo.style.display = 'block';
        }

        // Actions qui MARCHENT
        function downloadPDF() {
            if (!currentCvData) {
                showMessage('error', 'Aucun CV à télécharger');
                return;
            }

            try {
                const printWindow = window.open('', '_blank');
                const cvContent = document.getElementById('cvPreview').innerHTML;
                
                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>CV_PROFIL_${currentCvData.profileCode}</title>
                        <style>
                            @page { margin: 0; size: A4; }
                            body { 
                                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
                                margin: 0; 
                                padding: 0; 
                                font-size: 11pt;
                                line-height: 1.4;
                            }
                            .cv-container { width: 210mm; min-height: 297mm; margin: 0; }
                            .cv-header { background: linear-gradient(135deg, #004199 0%, #0056cc 100%); padding: 20px 25px; display: flex; justify-content: space-between; align-items: center; color: white; }
                            .cv-logo-container { background: white; padding: 10px 12px; border-radius: 6px; }
                            .cv-logo-container img { height: 35px; width: auto; }
                            .cv-profile-info { text-align: center; flex: 1; margin-left: 30px; }
                            .cv-job-title { font-size: 16pt; font-weight: 700; margin-bottom: 6px; }
                            .cv-profile-code { font-size: 12pt; font-weight: 700; color: #00ff7f; background: rgba(0, 255, 127, 0.15); padding: 4px 12px; border-radius: 15px; display: inline-block; border: 1px solid rgba(0, 255, 127, 0.3); }
                            .cv-content { padding: 25px 30px; }
                            .cv-section { margin-bottom: 25px; page-break-inside: avoid; }
                            .cv-section-title { background: #004199; color: white; padding: 8px 20px; font-size: 12pt; font-weight: 700; text-align: center; text-transform: uppercase; border-radius: 20px; margin-bottom: 15px; }
                            .cv-experience { margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #004199; }
                            .cv-job-position { color: #004199; font-weight: 700; font-size: 11pt; margin-bottom: 6px; }
                            .cv-job-details { color: #00bf63; font-size: 10pt; font-weight: 600; margin-bottom: 12px; background: rgba(0, 191, 99, 0.1); padding: 3px 8px; border-radius: 10px; display: inline-block; }
                            .cv-subcategory { color: #000; font-weight: 700; font-size: 11pt; margin: 10px 0 8px 0; }
                            .cv-missions ul { margin: 0; padding-left: 18px; }
                            .cv-missions li { margin-bottom: 6px; font-size: 11pt; line-height: 1.4; color: #000; }
                            .cv-competence-category { margin-bottom: 15px; padding: 12px; background: #f8f9fa; border-radius: 8px; border-top: 3px solid #004199; }
                            .cv-competence-list { display: flex; flex-wrap: wrap; gap: 6px; }
                            .cv-competence-item { background: white; color: #000; padding: 4px 10px; border-radius: 12px; font-size: 10pt; border: 1px solid #e0e0e0; }
                            .cv-formation-item { margin-bottom: 12px; padding: 12px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #00bf63; }
                            .cv-formation-title { font-weight: 700; color: #004199; font-size: 11pt; margin-bottom: 4px; }
                            .cv-formation-details { color: #00bf63; font-size: 10pt; font-weight: 600; }
                            .cv-simple-list ul { margin: 0; padding-left: 18px; }
                            .cv-simple-list li { margin-bottom: 6px; font-size: 11pt; color: #000; }
                        </style>
                    </head>
                    <body>
                        ${cvContent}
                    </body>
                    </html>
                `);
                
                printWindow.document.close();
                
                setTimeout(() => {
                    printWindow.focus();
                    printWindow.print();
                    printWindow.close();
                }, 1000);
                
                showMessage('success', 'Téléchargement PDF en cours...');
                
            } catch (error) {
                showMessage('error', 'Erreur téléchargement : ' + error.message);
            }
        }

        function printCV() {
            window.print();
        }

        function enableModification() {
            cvTextInput.scrollIntoView({ behavior: 'smooth' });
            cvTextInput.focus();
            showMessage('info', 'Vous pouvez maintenant modifier et régénérer le CV');
        }

        // Utility functions
        function showLoading(message = 'Chargement...', subtext = '') {
            document.querySelector('.loading-text').textContent = message;
            document.querySelector('.loading-subtext').textContent = subtext;
            loadingOverlay.style.display = 'flex';
            generateBtn.disabled = true;
        }

        function hideLoading() {
            loadingOverlay.style.display = 'none';
            generateBtn.disabled = false;
        }

        function showMessage(type, message) {
            hideMessages();
            let element;
            if (type === 'success') element = successMessage;
            else if (type === 'error') element = errorMessage;
            else if (type === 'info') element = apiKeyMessage;
            
            if (element) {
                element.textContent = message;
                element.classList.add('show');
                setTimeout(hideMessages, type === 'error' ? 8000 : 5000);
            }
        }

        function hideMessages() {
            successMessage.classList.remove('show');
            errorMessage.classList.remove('show');
            apiKeyMessage.classList.remove('show');
        }

        function showApiKeyPrompt() {
            const apiKey = prompt(`Configuration clé API OpenRouter

1. Créez un compte gratuit sur openrouter.ai
2. Obtenez votre clé API dans le dashboard  
3. Collez votre clé ici (format: sk-or-xxxxx)

Coût: ~2-5€ pour 100 CV analysés`);
            
            if (apiKey && apiKey.startsWith('sk-or-')) {
                AI_CONFIG.apiKey = apiKey;
                localStorage.setItem('openrouter_api_key', apiKey);
                showMessage('success', 'Clé API configurée avec succès ! L\'outil est prêt.');
            } else if (apiKey) {
                showMessage('error', 'Format invalide. La clé doit commencer par sk-or-');
            }
        }

        function loadSavedData() {
            const saved = localStorage.getItem('cv_anonymizer_data');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    cvTextInput.value = data.cvText || '';
                    document.getElementById('jobTitle').value = data.jobTitle || '';
                    document.getElementById('profileCode').value = data.profileCode || '';
                    document.getElementById('availability').value = data.availability || '';
                    document.getElementById('mobility').value = data.mobility || '';
                    document.getElementById('salary').value = data.salary || '';
                    document.getElementById('remark').value = data.remark || '';
                    document.getElementById('soufyaneRemark').value = data.soufyaneRemark || '';
                    updateCharCounter();
                    
                    // Charger le CV généré s'il existe
                    const savedCV = localStorage.getItem('cv_anonymizer_generated');
                    if (savedCV) {
                        currentCvData = JSON.parse(savedCV);
                        displayAnonymousCV();
                        displayInternalInfo();
                    }
                } catch (e) {
                    console.log('Erreur chargement données');
                }
            }
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            // Charger la clé API sauvegardée
            const savedApiKey = localStorage.getItem('openrouter_api_key');
            if (savedApiKey) {
                AI_CONFIG.apiKey = savedApiKey;
            }

            // Charger les données sauvegardées
            loadSavedData();
            
            // Initialiser le compteur
            updateCharCounter();
            
            console.log('CV Anonymizer TAFINAR initialisé - Version complète fonctionnelle');
        });

        // Styles d'impression intégrés
        const printStyles = document.createElement('style');
        printStyles.textContent = `
            @media print {
                body * { visibility: hidden; }
                .cv-preview, .cv-preview * { visibility: visible; }
                .cv-preview { 
                    position: absolute; 
                    left: 0; 
                    top: 0; 
                    width: 100%; 
                    height: 100%;
                    border: none !important;
                    border-radius: 0 !important;
                    box-shadow: none !important;
                    max-width: none;
                }
                .cv-container {
                    width: 210mm;
                    min-height: 297mm;
                    margin: 0;
                    box-shadow: none;
                }
                .cv-header { border-radius: 0; page-break-inside: avoid; }
                .cv-section { page-break-inside: avoid; }
                .cv-section-title { page-break-after: avoid; }
                .cv-experience { page-break-inside: avoid; }
            }
        `;
        document.head.appendChild(printStyles);
    </script>
</body>
</html>
