<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV Anonymizer - TAFINAR</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Header Application */
        .app-header {
            background: linear-gradient(135deg, #004199 0%, #0056cc 100%);
            padding: 30px 0;
            color: white;
            box-shadow: 0 8px 32px rgba(0, 65, 153, 0.3);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            gap: 40px;
        }

        .app-logo {
            height: 70px;
            background: white;
            padding: 15px 20px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        .app-logo img {
            height: 100%;
            width: auto;
        }

        .header-text h1 {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 10px;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .header-text p {
            font-size: 18px;
            opacity: 0.95;
            font-weight: 500;
        }

        /* Main Container */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }

        /* Sections */
        .section {
            background: white;
            border-radius: 20px;
            padding: 35px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
            border: 1px solid rgba(0, 65, 153, 0.08);
        }

        .section-title {
            font-size: 22px;
            font-weight: 800;
            color: #004199;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .section-title::before {
            content: "";
            width: 6px;
            height: 28px;
            background: linear-gradient(180deg, #004199 0%, #00bf63 100%);
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0, 65, 153, 0.3);
        }

        /* Upload Zone */
        .upload-zone {
            border: 3px dashed #004199;
            border-radius: 20px;
            padding: 60px 40px;
            text-align: center;
            background: linear-gradient(135deg, rgba(0, 65, 153, 0.03) 0%, rgba(0, 191, 99, 0.02) 100%);
            cursor: pointer;
            transition: all 0.4s ease;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .upload-zone::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .upload-zone:hover::before {
            left: 100%;
        }

        .upload-zone:hover {
            border-color: #00bf63;
            background: linear-gradient(135deg, rgba(0, 191, 99, 0.08) 0%, rgba(0, 65, 153, 0.03) 100%);
            transform: translateY(-4px);
            box-shadow: 0 15px 35px rgba(0, 191, 99, 0.2);
        }

        .upload-icon {
            font-size: 70px;
            margin-bottom: 25px;
            transition: all 0.3s ease;
        }

        .upload-text {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
            font-weight: 600;
        }

        .upload-formats {
            font-size: 16px;
            color: #666;
            margin-bottom: 25px;
        }

        .upload-options {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .upload-btn {
            padding: 15px 25px;
            border: 3px solid #004199;
            background: white;
            color: #004199;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
        }

        .upload-btn:hover {
            background: #004199;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 65, 153, 0.3);
        }

        .upload-btn.image-mode {
            border-color: #00bf63;
            color: #00bf63;
        }

        .upload-btn.image-mode:hover {
            background: #00bf63;
            color: white;
            box-shadow: 0 8px 20px rgba(0, 191, 99, 0.3);
        }

        .file-input {
            display: none;
        }

        /* Text Input */
        .cv-text-input {
            width: 100%;
            min-height: 400px;
            max-height: 600px;
            padding: 25px;
            border: 3px solid #e8ecf4;
            border-radius: 15px;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            font-size: 13px;
            resize: vertical;
            margin-bottom: 25px;
            transition: all 0.3s ease;
            background: #fafbfc;
            overflow-y: auto;
            line-height: 1.6;
        }

        .cv-text-input:focus {
            outline: none;
            border-color: #004199;
            background: white;
            box-shadow: 0 0 0 6px rgba(0, 65, 153, 0.1), 0 8px 25px rgba(0, 65, 153, 0.15);
        }

        .char-counter {
            text-align: right;
            font-size: 13px;
            color: #666;
            margin-bottom: 25px;
            font-weight: 600;
        }

        /* Form Fields */
        .form-grid {
            display: grid;
            gap: 25px;
            margin-bottom: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .form-label {
            font-weight: 700;
            color: #333;
            font-size: 15px;
        }

        .form-label.required::after {
            content: " *";
            color: #dc3545;
        }

        .form-input {
            padding: 18px;
            border: 3px solid #e8ecf4;
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.3s ease;
            background: #fafbfc;
            font-weight: 500;
        }

        .form-input:focus {
            outline: none;
            border-color: #004199;
            background: white;
            box-shadow: 0 0 0 4px rgba(0, 65, 153, 0.1);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }

        /* Buttons */
        .btn {
            padding: 20px 40px;
            border: none;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            justify-content: center;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #004199 0%, #0056cc 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(0, 65, 153, 0.4);
            width: 100%;
            font-size: 19px;
            padding: 22px;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(0, 65, 153, 0.5);
        }

        .btn-primary:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: linear-gradient(135deg, #00bf63 0%, #00d66c 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(0, 191, 99, 0.4);
        }

        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(0, 191, 99, 0.5);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4);
        }

        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(108, 117, 125, 0.5);
        }

        /* CV Preview Container - Format A4 */
        .cv-preview {
            border: 3px solid #e8ecf4;
            border-radius: 20px;
            background: white;
            overflow: hidden;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
            width: 100%;
            max-width: 794px;
            margin: 0 auto;
        }

        /* CV Container - A4 WOW Design */
        .cv-container {
            width: 794px;
            min-height: 1123px;
            background: white;
            font-size: 12pt;
            line-height: 1.5;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0 auto;
            position: relative;
        }

        /* HEADER MAGNIFIQUE */
        .cv-header {
            background: linear-gradient(135deg, #004199 0%, #0056cc 50%, #004199 100%);
            padding: 35px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .cv-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 30% 20%, rgba(255,255,255,0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .cv-logo-container {
            background: white;
            padding: 18px 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            z-index: 2;
            position: relative;
        }

        .cv-logo-container img {
            height: 55px;
            width: auto;
        }

        .cv-profile-info {
            text-align: center;
            flex: 1;
            margin-left: 50px;
            z-index: 2;
            position: relative;
        }

        .cv-job-title {
            font-size: 22pt;
            font-weight: 800;
            margin-bottom: 12px;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            letter-spacing: 0.5px;
        }

        .cv-profile-code {
            font-size: 16pt;
            font-weight: 800;
            color: #00ff7f;
            background: rgba(0, 255, 127, 0.2);
            padding: 10px 25px;
            border-radius: 25px;
            display: inline-block;
            border: 2px solid rgba(0, 255, 127, 0.4);
            box-shadow: 0 4px 15px rgba(0, 255, 127, 0.3);
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        /* TRAIT MAGNIFIQUE sous le header */
        .cv-header-separator {
            height: 8px;
            background: linear-gradient(90deg, #004199 0%, #00bf63 50%, #004199 100%);
            box-shadow: 0 4px 15px rgba(0, 65, 153, 0.3);
            position: relative;
        }

        .cv-header-separator::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.3) 50%, transparent 100%);
        }

        .cv-content {
            padding: 40px 45px;
            background: white;
        }

        /* SECTIONS MAGNIFIQUES avec bordures arrondies */
        .cv-section {
            margin-bottom: 35px;
            page-break-inside: avoid;
        }

        .cv-section-title {
            background: linear-gradient(135deg, #004199 0%, #0056cc 100%);
            color: white;
            padding: 15px 30px;
            font-size: 14pt;
            font-weight: 800;
            text-align: center;
            text-transform: uppercase;
            border-radius: 25px;
            margin-bottom: 25px;
            box-shadow: 0 6px 20px rgba(0, 65, 153, 0.3);
            letter-spacing: 1px;
            position: relative;
        }

        .cv-section-title::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, transparent 50%, rgba(255,255,255,0.1) 100%);
            border-radius: 25px;
        }

        /* EXPÉRIENCES avec style WOW */
        .cv-experience {
            margin-bottom: 25px;
            padding: 25px;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: 18px;
            border-left: 6px solid #004199;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
        }

        .cv-experience::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, rgba(0, 65, 153, 0.05) 0%, transparent 70%);
            border-radius: 50%;
            transform: translate(30px, -30px);
        }

        .cv-job-position {
            color: #004199;
            font-weight: 800;
            font-size: 13pt;
            margin-bottom: 8px;
            line-height: 1.3;
            position: relative;
            z-index: 1;
        }

        .cv-job-details {
            color: #00bf63;
            font-size: 11pt;
            font-weight: 700;
            margin-bottom: 15px;
            background: linear-gradient(135deg, rgba(0, 191, 99, 0.15) 0%, rgba(0, 191, 99, 0.05) 100%);
            padding: 8px 15px;
            border-radius: 15px;
            display: inline-block;
            border: 1px solid rgba(0, 191, 99, 0.3);
            position: relative;
            z-index: 1;
        }

        .cv-subcategory {
            color: #000;
            font-weight: 800;
            font-size: 12pt;
            margin: 15px 0 12px 0;
            position: relative;
            z-index: 1;
        }

        .cv-missions {
            margin: 12px 0;
            position: relative;
            z-index: 1;
        }

        .cv-missions ul {
            margin: 0;
            padding-left: 25px;
        }

        .cv-missions li {
            margin-bottom: 8px;
            font-size: 12pt;
            line-height: 1.6;
            color: #000;
            text-align: justify;
        }

        /* COMPÉTENCES comme dans vos images */
        .cv-competence-category {
            margin-bottom: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: 18px;
            border-top: 6px solid #004199;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        .cv-competence-title {
            font-weight: 800;
            color: #004199;
            margin-bottom: 15px;
            font-size: 13pt;
        }

        .cv-competence-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .cv-competence-item {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            color: #333;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 11pt;
            border: 2px solid #e0e0e0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            font-weight: 600;
        }

        /* FORMATIONS magnifiques */
        .cv-formation-item {
            margin-bottom: 18px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: 18px;
            border-left: 6px solid #00bf63;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        .cv-formation-title {
            font-weight: 800;
            color: #004199;
            font-size: 13pt;
            margin-bottom: 6px;
        }

        .cv-formation-details {
            color: #00bf63;
            font-size: 11pt;
            font-weight: 700;
        }

        /* LANGUES avec style */
        .cv-language-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: 15px;
            border-left: 4px solid #00bf63;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .cv-language-name {
            font-weight: 700;
            color: #333;
            font-size: 12pt;
        }

        .cv-language-level {
            background: linear-gradient(135deg, #00bf63 0%, #00d66c 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 10pt;
            font-weight: 700;
        }

        .cv-simple-list ul {
            margin: 0;
            padding-left: 25px;
        }

        .cv-simple-list li {
            margin-bottom: 8px;
            font-size: 12pt;
            color: #000;
            line-height: 1.6;
        }

        /* Messages */
        .message {
            padding: 18px;
            border-radius: 12px;
            margin: 25px 0;
            display: none;
            font-weight: 600;
            font-size: 15px;
        }

        .message.show {
            display: block;
        }

        .message-success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border: 2px solid #c3e6cb;
            box-shadow: 0 4px 15px rgba(21, 87, 36, 0.2);
        }

        .message-error {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            border: 2px solid #f5c6cb;
            box-shadow: 0 4px 15px rgba(114, 28, 36, 0.2);
        }

        .message-info {
            background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
            color: #0c5460;
            border: 2px solid #bee5eb;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(12, 84, 96, 0.2);
        }

        /* Actions */
        .actions {
            display: none;
            gap: 20px;
            margin-top: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .actions.show {
            display: flex;
        }

        /* Internal Info */
        .internal-info {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 50%, #fff3cd 100%);
            border: 3px solid #ffeaa7;
            border-radius: 18px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: 0 6px 20px rgba(255, 234, 167, 0.3);
        }

        .info-grid {
            display: grid;
            gap: 15px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 15px 20px;
            background: white;
            border-radius: 12px;
            border-left: 6px solid #004199;
            font-size: 14px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .info-label {
            font-weight: 800;
            color: #004199;
        }

        .info-value {
            color: #333;
            font-style: italic;
            font-weight: 600;
        }

        /* Loading */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loading-content {
            background: white;
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            max-width: 450px;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 6px solid #f3f3f3;
            border-top: 6px solid #004199;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 25px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: #333;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .loading-subtext {
            color: #666;
            font-size: 16px;
            font-weight: 500;
        }

        /* Styles d'impression A4 parfaits */
        @media print {
            body * {
                visibility: hidden;
            }
            
            .cv-preview, .cv-preview * {
                visibility: visible;
            }
            
            .cv-preview {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
                border: none;
                border-radius: 0;
                box-shadow: none;
                max-width: none;
            }
            
            .cv-container {
                width: 210mm;
                min-height: 297mm;
                margin: 0;
                box-shadow: none;
                font-size: 11pt; /* Police lisible à l'impression */
            }
            
            .cv-header {
                border-radius: 0;
                page-break-inside: avoid;
                padding: 25mm 15mm;
            }
            
            .cv-content {
                padding: 15mm;
            }
            
            .cv-section {
                page-break-inside: avoid;
                margin-bottom: 8mm;
            }
            
            .cv-section-title {
                page-break-after: avoid;
                font-size: 12pt;
            }
            
            .cv-experience {
                page-break-inside: avoid;
                margin-bottom: 6mm;
            }
            
            .cv-missions li {
                font-size: 10pt;
                line-height: 1.4;
            }
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 1fr;
                max-width: 900px;
            }
            
            .cv-container {
                width: 100%;
                max-width: 794px;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 25px;
            }

            .main-container {
                padding: 25px 15px;
                gap: 30px;
            }

            .section {
                padding: 25px;
            }

            .cv-text-input {
                min-height: 350px;
            }

            .cv-header {
                flex-direction: column;
                text-align: center;
                gap: 20px;
                padding: 25px 20px;
            }

            .cv-profile-info {
                margin-left: 0;
            }

            .upload-options {
                flex-direction: column;
            }

            .actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
            
            .cv-container {
                font-size: 11pt;
                padding: 0 15px;
            }
            
            .cv-content {
                padding: 25px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="app-header">
        <div class="header-content">
            <div class="app-logo">
                <img src="https://image.jimcdn.com/app/cms/image/transf/dimension=400x10000:format=png/path/sff9eaf88e82d8f8a/image/ifdd007cf2d2293e3/version/1616433262/image.png" alt="TAFINAR">
            </div>
            <div class="header-text">
                <h1>CV Anonymizer</h1>
                <p>Anonymisation professionnelle avec design premium</p>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Input Section -->
        <div class="section">
            <div class="section-title">CV à traiter</div>
            
            <!-- Upload Zone -->
            <div class="upload-zone" id="uploadZone">
                <div class="upload-icon">📄</div>
                <div class="upload-text">Glissez-déposez votre CV ou sélectionnez une option</div>
                <div class="upload-formats">PDF, DOC, DOCX ou IMAGE (PNG, JPG)</div>
                
                <div class="upload-options">
                    <button class="upload-btn" id="textBtn">📄 Extraire le texte</button>
                    <button class="upload-btn image-mode" id="imageBtn">🖼️ Traiter comme image</button>
                </div>
                
                <input type="file" id="fileInput" class="file-input" accept=".pdf,.doc,.docx">
                <input type="file" id="imageInput" class="file-input" accept="image/*,.pdf">
            </div>

            <div style="text-align: center; margin: 25px 0; color: #666; font-weight: 700; font-size: 18px;">OU</div>

            <!-- Text Input -->
            <textarea 
                id="cvTextInput" 
                class="cv-text-input" 
                placeholder="Collez ici le texte de votre CV...

Si votre CV est mal formaté après copier-coller, utilisez l'option 'Traiter comme image' ci-dessus.

EXEMPLE :
================

SOFREN | Lyon | Janvier 2024 - présent
INGÉNIEUR ENVIRONNEMENT
Mission chez EDF | CNPE Saint-Alban | Avril 2024 - Juin 2025
• Rédaction du Rapport Environnemental Annuel 2024
• Proposition d'améliorations dans le processus de réalisation du REA
• Élaboration du Bulletin d'Information Environnement

INGÉNIEUR D'ÉTUDES ENVIRONNEMENT ET RISQUE CONVENTIONNEL
Mission chez EDVANCE | Lyon | Janvier 2024 - Janvier 2025
CHIMIE
• Réalisation d'études de risque incendie
• Études environnementales selon la norme ISO 14001

FORMATION
Master Génie des Procédés | INSA Lyon | 2020-2022

COMPÉTENCES
• AutoCAD, SolidWorks
• Analyse de risques
• ISO 14001

LANGUES
• Français : Natif  
• Anglais : Courant
• Espagnol : Intermédiaire

================
Continuez avec tout votre CV..."></textarea>

            <div class="char-counter" id="charCounter">0 caractères</div>

            <!-- Form Fields -->
            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label required">Poste recherché</label>
                    <input type="text" id="jobTitle" class="form-input" placeholder="Ex: Ingénieur Environnement Senior" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Code profil (optionnel)</label>
                    <input type="text" id="profileCode" class="form-input" placeholder="Ex: ABC (généré automatiquement si vide)">
                </div>

                <div class="form-group">
                    <label class="form-label">Disponibilité</label>
                    <input type="text" id="availability" class="form-input" placeholder="Ex: Immédiate, 2 mois de préavis...">
                </div>

                <div class="form-group">
                    <label class="form-label">Mobilité géographique</label>
                    <input type="text" id="mobility" class="form-input" placeholder="Ex: France entière, Région Lyonnaise...">
                </div>

                <div class="form-group">
                    <label class="form-label">Prétention salariale</label>
                    <input type="text" id="salary" class="form-input" placeholder="Ex: 45-55k€, À négocier...">
                </div>

                <div class="form-group">
                    <label class="form-label">Remarques générales</label>
                    <textarea id="remark" class="form-input form-textarea" placeholder="Remarques sur le profil, points forts..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Notes pour Soufyane</label>
                    <textarea id="soufyaneRemark" class="form-input form-textarea" placeholder="Notes internes, commentaires stratégiques..."></textarea>
                </div>
            </div>

            <!-- Generate Button -->
            <button type="button" id="generateBtn" class="btn btn-primary">
                <span>🚀 Analyser et générer le CV anonyme</span>
            </button>

            <!-- Messages -->
            <div id="successMessage" class="message message-success">
                ✅ CV anonyme généré avec succès ! Design premium appliqué.
            </div>
            <div id="errorMessage" class="message message-error">
                ❌ Erreur lors de la génération. Vérifiez les données ou réessayez.
            </div>
            <div id="apiKeyMessage" class="message message-info">
                🔑 Cliquez ici pour configurer votre clé API et utiliser l'outil.
            </div>
        </div>

        <!-- Preview Section -->
        <div class="section">
            <div class="section-title">Aperçu CV anonyme (Format A4 Premium)</div>
            
            <div id="cvPreview" class="cv-preview">
                <div class="cv-container">
                    <div class="cv-header">
                        <div class="cv-logo-container">
                            <img src="https://image.jimcdn.com/app/cms/image/transf/dimension=400x10000:format=png/path/sff9eaf88e82d8f8a/image/ifdd007cf2d2293e3/version/1616433262/image.png" alt="TAFINAR">
                        </div>
                        <div class="cv-profile-info">
                            <div class="cv-job-title" id="previewJobTitle">Poste à définir</div>
                            <div class="cv-profile-code" id="previewProfileCode">PROFIL XXX</div>
                        </div>
                    </div>
                    <div class="cv-header-separator"></div>
                    <div class="cv-content">
                        <div id="previewContent">
                            <div style="text-align: center; color: #666; padding: 60px 30px;">
                                <p style="font-size: 16pt; margin-bottom: 20px; font-weight: 700;">L'aperçu du CV anonyme apparaîtra ici</p>
                                <p style="font-size: 14pt; margin-bottom: 15px;">Format A4 Premium - Design WOW</p>
                                <p style="font-size: 12pt; color: #999;">Fournissez un CV et cliquez sur "Analyser"</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div id="previewActions" class="actions">
                <button type="button" id="downloadBtn" class="btn btn-success">
                    💾 Télécharger PDF
                </button>
                <button type="button" id="printBtn" class="btn btn-primary">
                    🖨️ Imprimer
                </button>
                <button type="button" id="resetBtn" class="btn btn-secondary">
                    🔄 Nouveau CV
                </button>
            </div>

            <!-- Internal Info -->
            <div id="internalInfo" class="internal-info">
                <div class="section-title">📋 Informations sauvegardées</div>
                <div id="infoGrid" class="info-grid"></div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">Analyse IA en cours...</div>
            <div class="loading-subtext">Génération du design premium</div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        // Configuration IA avec vision
        const AI_CONFIG = {
            apiUrl: 'https://openrouter.ai/api/v1/chat/completions',
            apiKey: '',
            textModel: 'anthropic/claude-3.5-sonnet',
            visionModel: 'anthropic/claude-3.5-sonnet'
        };

        // Variables globales avec stockage avancé
        let currentCvData = null;
        let processingMode = 'text';
        let isRealTimeEnabled = true;

        // Stockage avancé avec compression
        const Storage = {
            save: (key, data) => {
                try {
                    const compressed = JSON.stringify(data);
                    localStorage.setItem(key, compressed);
                    return true;
                } catch (e) {
                    console.error('Erreur sauvegarde:', e);
                    return false;
                }
            },
            
            load: (key) => {
                try {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : null;
                } catch (e) {
                    console.error('Erreur chargement:', e);
                    return null;
                }
            },
            
            remove: (key) => {
                try {
                    localStorage.removeItem(key);
                    return true;
                } catch (e) {
                    return false;
                }
            }
        };

        // Elements DOM
        const uploadZone = document.getElementById('uploadZone');
        const textBtn = document.getElementById('textBtn');
        const imageBtn = document.getElementById('imageBtn');
        const fileInput = document.getElementById('fileInput');
        const imageInput = document.getElementById('imageInput');
        const cvTextInput = document.getElementById('cvTextInput');
        const generateBtn = document.getElementById('generateBtn');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const cvPreview = document.getElementById('cvPreview');
        const previewActions = document.getElementById('previewActions');
        const successMessage = document.getElementById('successMessage');
        const errorMessage = document.getElementById('errorMessage');
        const apiKeyMessage = document.getElementById('apiKeyMessage');
        const internalInfo = document.getElementById('internalInfo');
        const charCounter = document.getElementById('charCounter');

        // Event Listeners
        textBtn.addEventListener('click', () => {
            processingMode = 'text';
            fileInput.click();
        });

        imageBtn.addEventListener('click', () => {
            processingMode = 'image';
            imageInput.click();
        });

        uploadZone.addEventListener('dragover', handleDragOver);
        uploadZone.addEventListener('dragleave', handleDragLeave);
        uploadZone.addEventListener('drop', handleDrop);
        
        fileInput.addEventListener('change', (e) => handleFileSelect(e, 'text'));
        imageInput.addEventListener('change', (e) => handleFileSelect(e, 'image'));
        
        generateBtn.addEventListener('click', generateAnonymousCV);
        document.getElementById('downloadBtn').addEventListener('click', downloadPDF);
        document.getElementById('printBtn').addEventListener('click', printCV);
        document.getElementById('resetBtn').addEventListener('click', resetAll);
        apiKeyMessage.addEventListener('click', showApiKeyPrompt);

        // TEMPS RÉEL - Mise à jour automatique
        cvTextInput.addEventListener('input', handleTextChange);
        
        // Auto-save intelligent
        const formInputs = ['jobTitle', 'profileCode', 'availability', 'mobility', 'salary', 'remark', 'soufyaneRemark'];
        formInputs.forEach(id => {
            const element = document.getElementById(id);
            element.addEventListener('input', handleInputChange);
            element.addEventListener('blur', forceSave);
        });

        function handleTextChange() {
            updateCharCounter();
            debounceAutoSave();
            
            // TEMPS RÉEL - Si un CV est déjà généré, proposer la mise à jour
            if (currentCvData && isRealTimeEnabled) {
                const currentText = cvTextInput.value.trim();
                if (currentText.length > 100 && Math.abs(currentText.length - (currentCvData.originalLength || 0)) > 100) {
                    showRealTimeUpdate();
                }
            }
        }

        function handleInputChange() {
            debounceAutoSave();
            
            // TEMPS RÉEL - Mise à jour des infos
            if (currentCvData && isRealTimeEnabled) {
                updateInternalInfoRealTime();
            }
        }

        function showRealTimeUpdate() {
            const content = document.getElementById('previewContent');
            content.innerHTML = `
                <div style="text-align: center; color: #004199; padding: 40px 20px; background: linear-gradient(135deg, rgba(0, 65, 153, 0.05) 0%, rgba(0, 191, 99, 0.05) 100%); border-radius: 15px; border: 2px dashed #004199;">
                    <p style="font-size: 14pt; margin-bottom: 15px; font-weight: 700;">📝 Contenu modifié détecté</p>
                    <p style="font-size: 12pt; margin-bottom: 20px;">Le texte du CV a été modifié</p>
                    <button onclick="generateAnonymousCV()" style="background: linear-gradient(135deg, #004199 0%, #0056cc 100%); color: white; border: none; padding: 12px 25px; border-radius: 8px; font-weight: 700; cursor: pointer;">🚀 Régénérer maintenant</button>
                </div>
            `;
        }

        function updateInternalInfoRealTime() {
            if (document.getElementById('infoGrid').innerHTML) {
                displayInternalInfo();
            }
        }

        function updateCharCounter() {
            const count = cvTextInput.value.length;
            charCounter.textContent = `${count.toLocaleString()} caractères`;
            
            if (count > 100000) {
                charCounter.style.color = '#dc3545';
                charCounter.textContent += ' (CV très long - optimisé)';
            } else if (count > 50000) {
                charCounter.style.color = '#fd7e14';
                charCounter.textContent += ' (CV long)';
            } else {
                charCounter.style.color = '#666';
            }
        }

        // Auto-save intelligent avec debounce
        let autoSaveTimeout;
        function debounceAutoSave() {
            clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(autoSave, 1500);
        }

        function forceSave() {
            clearTimeout(autoSaveTimeout);
            autoSave();
        }

        function autoSave() {
            const formData = collectFormData();
            const saved = Storage.save('cv_anonymizer_data', formData);
            
            if (saved) {
                // Indicateur visuel discret de sauvegarde
                showAutoSaveIndicator();
            }
        }

        function showAutoSaveIndicator() {
            const indicator = document.createElement('div');
            indicator.textContent = '💾 Sauvegardé';
            indicator.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #00bf63 0%, #00d66c 100%);
                color: white;
                padding: 8px 15px;
                border-radius: 20px;
                font-size: 12px;
                font-weight: 700;
                z-index: 10000;
                opacity: 0;
                transform: translateY(-10px);
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px rgba(0, 191, 99, 0.3);
            `;
            
            document.body.appendChild(indicator);
            
            setTimeout(() => {
                indicator.style.opacity = '1';
                indicator.style.transform = 'translateY(0)';
            }, 100);
            
            setTimeout(() => {
                indicator.style.opacity = '0';
                indicator.style.transform = 'translateY(-10px)';
                setTimeout(() => document.body.removeChild(indicator), 300);
            }, 2000);
        }

        function collectFormData() {
            return {
                cvText: cvTextInput.value,
                jobTitle: document.getElementById('jobTitle').value,
                profileCode: document.getElementById('profileCode').value,
                availability: document.getElementById('availability').value,
                mobility: document.getElementById('mobility').value,
                salary: document.getElementById('salary').value,
                remark: document.getElementById('remark').value,
                soufyaneRemark: document.getElementById('soufyaneRemark').value,
                timestamp: new Date().toISOString(),
                processingMode: processingMode
            };
        }

        // Drag & Drop handlers améliorés
        function handleDragOver(e) {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                if (file.type.startsWith('image/')) {
                    processingMode = 'image';
                    processFile(file, 'image');
                } else {
                    processingMode = 'text';
                    processFile(file, 'text');
                }
            }
        }

        function handleFileSelect(e, mode) {
            const file = e.target.files[0];
            if (file) {
                processFile(file, mode);
            }
        }

        // File processing amélioré
        async function processFile(file, mode) {
            try {
                showLoading(
                    `${mode === 'image' ? '🖼️ Analyse image IA' : '📄 Extraction texte'}`, 
                    'Traitement premium en cours...'
                );
                
                if (mode === 'image') {
                    await processImageFile(file);
                } else {
                    await processTextFile(file);
                }
                
            } catch (error) {
                hideLoading();
                showMessage('error', 'Erreur traitement : ' + error.message);
            }
        }

        async function processTextFile(file) {
            let text = '';
            
            if (file.type === 'application/pdf') {
                text = await extractTextFromPDF(file);
            } else if (file.type.includes('word') || file.name.endsWith('.docx') || file.name.endsWith('.doc')) {
                text = await extractTextFromWord(file);
            } else {
                throw new Error('Format non supporté pour extraction texte');
            }

            cvTextInput.value = text;
            updateCharCounter();
            hideLoading();
            showMessage('success', `✅ Texte extrait avec succès ! ${text.length.toLocaleString()} caractères.`);
            
            uploadZone.querySelector('.upload-text').textContent = `📄 Fichier traité: ${file.name}`;
        }

        async function processImageFile(file) {
            const base64 = await fileToBase64(file);
            const extractedText = await analyzeImageCV(base64, file.type);
            
            cvTextInput.value = extractedText;
            updateCharCounter();
            hideLoading();
            showMessage('success', '🖼️ CV analysé depuis l\'image avec succès !');
            
            uploadZone.querySelector('.upload-text').textContent = `🖼️ Image traitée: ${file.name}`;
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => {
                    const base64 = reader.result.split(',')[1];
                    resolve(base64);
                };
                reader.onerror = error => reject(error);
            });
        }

        // Analyse d'image CV avec IA vision
        async function analyzeImageCV(base64Image, mimeType) {
            if (!AI_CONFIG.apiKey) {
                throw new Error('Clé API requise');
            }

            const prompt = `Analyse cette image de CV et extrais TOUT le texte visible.

MISSION : Extraction complète et fidèle du contenu
- Extrais TOUT le texte, même les petits détails
- Préserve l'ordre et la structure originale  
- Identifie les sections (expériences, formations, compétences, etc.)
- Garde les dates, lieux, entreprises, missions exactement comme écrit
- N'invente RIEN, n'ajoute RIEN qui ne soit pas visible
- Structure le texte de manière lisible et organisée

Réponds avec le texte complet extrait de l'image, bien structuré.`;

            try {
                const response = await fetch(AI_CONFIG.apiUrl, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${AI_CONFIG.apiKey}`,
                        'Content-Type': 'application/json',
                        'HTTP-Referer': window.location.origin
                    },
                    body: JSON.stringify({
                        model: AI_CONFIG.visionModel,
                        messages: [
                            {
                                role: 'system',
                                content: 'Tu es un expert en extraction de texte depuis des images de CV. Tu extrais tout le texte visible sans rien modifier ni ajouter.'
                            },
                            {
                                role: 'user',
                                content: [
                                    {
                                        type: 'text',
                                        text: prompt
                                    },
                                    {
                                        type: 'image_url',
                                        image_url: {
                                            url: `data:${mimeType};base64,${base64Image}`
                                        }
                                    }
                                ]
                            }
                        ],
                        max_tokens: 4000,
                        temperature: 0.1
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Erreur API vision ${response.status}: ${errorText}`);
                }

                const data = await response.json();
                return data.choices[0].message.content;

            } catch (error) {
                throw new Error('Erreur analyse image : ' + error.message);
            }
        }

        // PDF extraction optimisée
        async function extractTextFromPDF(file) {
            return new Promise(async (resolve, reject) => {
                try {
                    pdfjsLib.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
                    
                    const arrayBuffer = await file.arrayBuffer();
                    const pdf = await pdfjsLib.getDocument({
                        data: arrayBuffer,
                        verbosity: 0
                    }).promise;
                    
                    let fullText = '';
                    const totalPages = pdf.numPages;

                    for (let i = 1; i <= totalPages; i++) {
                        const page = await pdf.getPage(i);
                        const textContent = await page.getTextContent();
                        
                        const pageText = textContent.items
                            .map(item => item.str)
                            .join(' ')
                            .replace(/\s+/g, ' ')
                            .trim();
                        
                        if (pageText) {
                            fullText += pageText + '\n\n';
                        }
                        
                        // Progress pour gros PDF
                        if (totalPages > 5) {
                            updateLoadingText(`📄 Page ${i}/${totalPages} (${Math.round((i/totalPages)*100)}%)`);
                        }
                    }

                    resolve(fullText.trim());
                } catch (error) {
                    reject(error);
                }
            });
        }

        async function extractTextFromWord(file) {
            throw new Error('Extraction Word non disponible. Utilisez l\'option image ou copiez-collez le texte.');
        }

        // GÉNÉRATION CV ANONYME avec design WOW
        async function generateAnonymousCV() {
            const cvText = cvTextInput.value.trim();
            const jobTitle = document.getElementById('jobTitle').value.trim();

            if (!cvText) {
                showMessage('error', 'Veuillez fournir le contenu du CV');
                return;
            }

            if (!jobTitle) {
                showMessage('error', 'Veuillez saisir le poste recherché');
                return;
            }

            if (!AI_CONFIG.apiKey) {
                showMessage('info', '🔑 Cliquez ici pour configurer votre clé API');
                return;
            }

            try {
                showLoading('🤖 Analyse IA avancée...', 'Génération du design premium en cours');
                
                const analysisResult = await analyzeAndStructureCV(cvText);
                
                if (analysisResult) {
                    const profileCode = document.getElementById('profileCode').value.trim() || generateProfileCode();

                    currentCvData = {
                        jobTitle: jobTitle,
                        profileCode: profileCode,
                        anonymizedContent: analysisResult,
                        originalLength: cvText.length,
                        processedAt: new Date().toISOString(),
                        processingMode: processingMode
                    };

                    Storage.save('cv_anonymizer_generated', currentCvData);
                    
                    displayAnonymousCV();
                    displayInternalInfo();
                    showMessage('success', '✅ CV anonyme généré avec design premium !');
                } else {
                    throw new Error('Erreur lors de l\'analyse IA');
                }

            } catch (error) {
                showMessage('error', 'Erreur : ' + error.message);
            } finally {
                hideLoading();
            }
        }

        // IA Analysis avec structure PARFAITE et design WOW
        async function analyzeAndStructureCV(cvText) {
            const prompt = `Tu es un expert en anonymisation et structuration de CV premium. 

MISSION CRITIQUE :
1. ANONYMISATION PRÉCISE : Supprimer UNIQUEMENT nom, prénom, email, téléphone, adresse personnelle
2. PRÉSERVATION TOTALE : Garder EXACTEMENT tout le contenu professionnel sans exception
3. STRUCTURATION PREMIUM : Organiser selon l'ordre STRICT demandé

ORDRE OBLIGATOIRE DES SECTIONS :
1. EXPÉRIENCES PROFESSIONNELLES (TOUJOURS en premier)
2. COMPÉTENCES (organisées par catégories)  
3. FORMATIONS (avec détails complets)
4. LANGUES (avec niveaux si disponibles)
5. Autres sections existantes

SUPPRESSIONS OBLIGATOIRES :
- Nom, prénom complets
- Adresses email complètes
- Numéros de téléphone
- Adresses personnelles complètes
- Toute introduction type "Profil professionnel", "À propos", "Présentation personnelle"

RÈGLES STRICTES DE PRÉSERVATION :
- JAMAIS résumer, raccourcir ou reformuler
- Garder CHAQUE mission et responsabilité exactement
- Préserver TOUTES les dates, lieux, entreprises
- Conserver TOUS les détails techniques et projets
- Maintenir TOUTES les compétences et technologies
- Garder TOUTES les formations avec établissements

FORMAT JSON REQUIS :
{
  "experiences": [
    {
      "poste": "titre exact du poste",
      "entreprise": "nom exact entreprise", 
      "dates": "dates exactes du CV",
      "lieu": "lieu exact",
      "subcategory": "sous-catégorie si elle existe sinon null",
      "missions": ["mission 1 complète exacte", "mission 2 complète exacte", "etc..."]
    }
  ],
  "competences": {
    "techniques": ["compétence technique 1", "compétence technique 2"],
    "outils": ["outil 1", "outil 2"],
    "autres": ["autre compétence 1", "autre compétence 2"]
  },
  "formations": [
    {
      "diplome": "diplôme complet exact",
      "etablissement": "établissement exact",
      "dates": "dates exactes",
      "lieu": "lieu exact si disponible",
      "details": "détails supplémentaires si ils existent"
    }
  ],
  "langues": [
    {
      "langue": "nom de la langue",
      "niveau": "niveau si spécifié sinon null"
    }
  ],
  "autres_sections": {
    "centres_interet": ["centre 1", "centre 2"],
    "certifications": ["certification 1", "certification 2"],
    "projets": ["projet 1", "projet 2"]
  }
}

CV à traiter (préservation totale requise) :
${cvText}`;

            try {
                const response = await fetch(AI_CONFIG.apiUrl, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${AI_CONFIG.apiKey}`,
                        'Content-Type': 'application/json',
                        'HTTP-Referer': window.location.origin
                    },
                    body: JSON.stringify({
                        model: AI_CONFIG.textModel,
                        messages: [
                            {
                                role: 'system', 
                                content: 'Tu es un expert premium en CV. Tu préserves EXACTEMENT tout le contenu professionnel et structures selon l\'ordre demandé. Réponse JSON uniquement.'
                            },
                            {
                                role: 'user',
                                content: prompt
                            }
                        ],
                        max_tokens: 8000,
                        temperature: 0.03 // Précision maximale
                    })
                });

                if (!response.ok) {
                    throw new Error(`Erreur API ${response.status}`);
                }

                const data = await response.json();
                const content = data.choices[0].message.content;
                
                const cleanJson = content.replace(/```json/g, '').replace(/```/g, '').trim();
                const parsedData = JSON.parse(cleanJson);
                
                return generatePremiumCVHTML(parsedData);

            } catch (error) {
                console.error('Erreur IA:', error);
                throw error;
            }
        }

        // Génération HTML PREMIUM avec design WOW
        function generatePremiumCVHTML(data) {
            let html = '';

            // 1. EXPÉRIENCES PROFESSIONNELLES (design premium)
            if (data.experiences && data.experiences.length > 0) {
                html += `
                    <div class="cv-section">
                        <div class="cv-section-title">Expériences Professionnelles</div>
                `;
                
                data.experiences.forEach(exp => {
                    html += `<div class="cv-experience">`;
                    
                    // Poste en bleu premium
                    if (exp.entreprise) {
                        html += `<div class="cv-job-position">${exp.entreprise} - ${exp.poste}</div>`;
                    } else {
                        html += `<div class="cv-job-position">${exp.poste}</div>`;
                    }
                    
                    // Dates/lieu en vert premium
                    let details = [];
                    if (exp.dates) details.push(exp.dates);
                    if (exp.lieu) details.push(exp.lieu);
                    if (details.length > 0) {
                        html += `<div class="cv-job-details">${details.join(' | ')}</div>`;
                    }
                    
                    // Sous-catégorie premium
                    if (exp.subcategory) {
                        html += `<div class="cv-subcategory">${exp.subcategory}</div>`;
                    }
                    
                    // Missions avec design premium
                    if (exp.missions && exp.missions.length > 0) {
                        html += `<div class="cv-missions"><ul>`;
                        exp.missions.forEach(mission => {
                            html += `<li>${mission}</li>`;
                        });
                        html += `</ul></div>`;
                    }
                    
                    html += `</div>`;
                });
                
                html += `</div>`;
            }

            // 2. COMPÉTENCES (design comme vos images)
            if (data.competences) {
                html += `<div class="cv-section"><div class="cv-section-title">Compétences</div>`;
                
                // Compétences techniques
                if (data.competences.techniques && data.competences.techniques.length > 0) {
                    html += `
                        <div class="cv-competence-category">
                            <div class="cv-competence-title">Compétences Techniques</div>
                            <div class="cv-competence-list">
                    `;
                    data.competences.techniques.forEach(comp => {
                        html += `<span class="cv-competence-item">${comp}</span>`;
                    });
                    html += `</div></div>`;
                }
                
                // Outils
                if (data.competences.outils && data.competences.outils.length > 0) {
                    html += `
                        <div class="cv-competence-category">
                            <div class="cv-competence-title">Outils & Technologies</div>
                            <div class="cv-competence-list">
                    `;
                    data.competences.outils.forEach(outil => {
                        html += `<span class="cv-competence-item">${outil}</span>`;
                    });
                    html += `</div></div>`;
                }
                
                // Autres compétences
                if (data.competences.autres && data.competences.autres.length > 0) {
                    html += `
                        <div class="cv-competence-category">
                            <div class="cv-competence-title">Autres Compétences</div>
                            <div class="cv-competence-list">
                    `;
                    data.competences.autres.forEach(comp => {
                        html += `<span class="cv-competence-item">${comp}</span>`;
                    });
                    html += `</div></div>`;
                }
                
                html += `</div>`;
            }

            // 3. FORMATIONS (design premium)
            if (data.formations && data.formations.length > 0) {
                html += `
                    <div class="cv-section">
                        <div class="cv-section-title">Formations</div>
                `;
                
                data.formations.forEach(formation => {
                    html += `<div class="cv-formation-item">`;
                    html += `<div class="cv-formation-title">${formation.diplome}</div>`;
                    
                    let details = [];
                    if (formation.dates) details.push(formation.dates);
                    if (formation.etablissement) details.push(formation.etablissement);
                    if (formation.lieu) details.push(formation.lieu);
                    
                    if (details.length > 0) {
                        html += `<div class="cv-formation-details">${details.join(' | ')}</div>`;
                    }
                    
                    if (formation.details) {
                        html += `<div style="margin-top: 8px; font-size: 11pt; color: #555;">${formation.details}</div>`;
                    }
                    html += `</div>`;
                });
                
                html += `</div>`;
            }

            // 4. LANGUES (design premium comme vos images)
            if (data.langues && data.langues.length > 0) {
                html += `
                    <div class="cv-section">
                        <div class="cv-section-title">Langues</div>
                `;
                
                data.langues.forEach(langue => {
                    html += `<div class="cv-language-item">`;
                    html += `<span class="cv-language-name">${langue.langue}</span>`;
                    if (langue.niveau) {
                        html += `<span class="cv-language-level">${langue.niveau}</span>`;
                    }
                    html += `</div>`;
                });
                
                html += `</div>`;
            }

            // 5. AUTRES SECTIONS
            if (data.autres_sections) {
                Object.entries(data.autres_sections).forEach(([sectionName, items]) => {
                    if (items && items.length > 0) {
                        const titleFormatted = sectionName.charAt(0).toUpperCase() + sectionName.slice(1).replace(/_/g, ' ');
                        html += `
                            <div class="cv-section">
                                <div class="cv-section-title">${titleFormatted}</div>
                                <div class="cv-simple-list">
                                    <ul>
                        `;
                        items.forEach(item => {
                            html += `<li>${item}</li>`;
                        });
                        html += `
                                    </ul>
                                </div>
                            </div>
                        `;
                    }
                });
            }

            return html;
        }

        function displayAnonymousCV() {
            if (currentCvData) {
                document.getElementById('previewJobTitle').textContent = currentCvData.jobTitle;
                document.getElementById('previewProfileCode').textContent = `PROFIL ${currentCvData.profileCode}`;
                document.getElementById('previewContent').innerHTML = currentCvData.anonymizedContent;
                previewActions.classList.add('show');
                
                // Activer le mode temps réel
                isRealTimeEnabled = true;
            }
        }

        function generateProfileCode() {
            const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            return Array.from({length: 3}, () => letters[Math.floor(Math.random() * letters.length)]).join('');
        }

        function displayInternalInfo() {
            const formData = collectFormData();
            const data = {
                'Poste recherché': formData.jobTitle || 'Non spécifié',
                'Code profil': currentCvData?.profileCode || 'Non généré',
                'Disponibilité': formData.availability || 'Non spécifiée',
                'Mobilité': formData.mobility || 'Non spécifiée',
                'Prétention salariale': formData.salary || 'Non spécifiée',
                'Remarque': formData.remark || 'Aucune',
                'Notes pour Soufyane': formData.soufyaneRemark || 'Aucune',
                'Mode traitement': processingMode === 'image' ? '🖼️ Analyse d\'image' : '📄 Extraction texte',
                'Taille CV original': currentCvData ? `${currentCvData.originalLength.toLocaleString()} caractères` : 'N/A',
                'Traité le': currentCvData ? new Date(currentCvData.processedAt).toLocaleString('fr-FR') : 'N/A'
            };

            let html = '';
            Object.entries(data).forEach(([label, value]) => {
                html += `
                    <div class="info-item">
                        <span class="info-label">${label} :</span>
                        <span class="info-value">${value}</span>
                    </div>
                `;
            });

            document.getElementById('infoGrid').innerHTML = html;
            internalInfo.style.display = 'block';
        }

        // TÉLÉCHARGEMENT PDF QUI MARCHE PARFAITEMENT
        function downloadPDF() {
            if (!currentCvData) {
                showMessage('error', 'Aucun CV à télécharger');
                return;
            }

            try {
                const printWindow = window.open('', '_blank');
                const cvContent = document.getElementById('cvPreview').innerHTML;
                
                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>CV_PROFIL_${currentCvData.profileCode}_TAFINAR</title>
                        <style>
                            @page { margin: 15mm; size: A4; }
                            body { 
                                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
                                margin: 0; 
                                padding: 0; 
                                font-size: 11pt;
                                line-height: 1.5;
                                color: #333;
                            }
                            .cv-container { width: 100%; margin: 0; }
                            
                            /* Header premium pour impression */
                            .cv-header { 
                                background: linear-gradient(135deg, #004199 0%, #0056cc 100%); 
                                padding: 20mm 15mm; 
                                display: flex; 
                                justify-content: space-between; 
                                align-items: center; 
                                color: white; 
                                -webkit-print-color-adjust: exact;
                                color-adjust: exact;
                            }
                            .cv-logo-container { background: white; padding: 12px 20px; border-radius: 12px; }
                            .cv-logo-container img { height: 40px; width: auto; }
                            .cv-profile-info { text-align: center; flex: 1; margin-left: 30px; }
                            .cv-job-title { font-size: 18pt; font-weight: 800; margin-bottom: 8px; }
                            .cv-profile-code { 
                                font-size: 14pt; 
                                font-weight: 800; 
                                color: #00ff7f; 
                                background: rgba(0, 255, 127, 0.2); 
                                padding: 8px 20px; 
                                border-radius: 20px; 
                                display: inline-block;
                                -webkit-print-color-adjust: exact;
                                color-adjust: exact;
                            }
                            
                            /* Trait premium */
                            .cv-header-separator { 
                                height: 6px; 
                                background: linear-gradient(90deg, #004199 0%, #00bf63 50%, #004199 100%); 
                                -webkit-print-color-adjust: exact;
                                color-adjust: exact;
                            }
                            
                            .cv-content { padding: 15mm; }
                            .cv-section { margin-bottom: 10mm; page-break-inside: avoid; }
                            
                            /* Titres de sections premium */
                            .cv-section-title { 
                                background: #004199; 
                                color: white; 
                                padding: 12px 25px; 
                                font-size: 12pt; 
                                font-weight: 800; 
                                text-align: center; 
                                text-transform: uppercase; 
                                border-radius: 20px; 
                                margin-bottom: 8mm; 
                                letter-spacing: 0.5px;
                                -webkit-print-color-adjust: exact;
                                color-adjust: exact;
                            }
                            
                            /* Expériences premium */
                            .cv-experience { 
                                margin-bottom: 6mm; 
                                padding: 15px 20px; 
                                background: #f8f9fa; 
                                border-radius: 12px; 
                                border-left: 5px solid #004199; 
                                page-break-inside: avoid;
                                -webkit-print-color-adjust: exact;
                                color-adjust: exact;
                            }
                            .cv-job-position { color: #004199; font-weight: 800; font-size: 11pt; margin-bottom: 5px; }
                            .cv-job-details { 
                                color: #00bf63; 
                                font-size: 10pt; 
                                font-weight: 700; 
                                margin-bottom: 8px; 
                                background: rgba(0, 191, 99, 0.1); 
                                padding: 6px 12px; 
                                border-radius: 12px; 
                                display: inline-block;
                                -webkit-print-color-adjust: exact;
                                color-adjust: exact;
                            }
                            .cv-subcategory { color: #000; font-weight: 800; font-size: 11pt; margin: 8px 0; }
                            .cv-missions ul { margin: 0; padding-left: 20px; }
                            .cv-missions li { margin-bottom: 4px; font-size: 10pt; line-height: 1.4; color: #000; }
                            
                            /* Compétences premium */
                            .cv-competence-category { 
                                margin-bottom: 8mm; 
                                padding: 12px 15px; 
                                background: #f8f9fa; 
                                border-radius: 12px; 
                                border-top: 4px solid #004199;
                                -webkit-print-color-adjust: exact;
                                color-adjust: exact;
                            }
                            .cv-competence-title { font-weight: 800; color: #004199; margin-bottom: 8px; font-size: 11pt; }
                            .cv-competence-list { display: flex; flex-wrap: wrap; gap: 6px; }
                            .cv-competence-item { 
                                background: white; 
                                color: #333; 
                                padding: 6px 12px; 
                                border-radius: 15px; 
                                font-size: 9pt; 
                                border: 1px solid #ddd; 
                                font-weight: 600;
                                -webkit-print-color-adjust: exact;
                                color-adjust: exact;
                            }
                            
                            /* Formations premium */
                            .cv-formation-item { 
                                margin-bottom: 6mm; 
                                padding: 12px 15px; 
                                background: #f8f9fa; 
                                border-radius: 12px; 
                                border-left: 5px solid #00bf63;
                                -webkit-print-color-adjust: exact;
                                color-adjust: exact;
                            }
                            .cv-formation-title { font-weight: 800; color: #004199; font-size: 11pt; margin-bottom: 4px; }
                            .cv-formation-details { color: #00bf63; font-size: 10pt; font-weight: 700; }
                            
                            /* Langues premium */
                            .cv-language-item { 
                                display: flex; 
                                justify-content: space-between; 
                                align-items: center; 
                                padding: 8px 15px; 
                                margin-bottom: 4mm; 
                                background: #f8f9fa; 
                                border-radius: 10px; 
                                border-left: 3px solid #00bf63;
                                -webkit-print-color-adjust: exact;
                                color-adjust: exact;
                            }
                            .cv-language-name { font-weight: 700; color: #333; font-size: 10pt; }
                            .cv-language-level { 
                                background: #00bf63; 
                                color: white; 
                                padding: 3px 10px; 
                                border-radius: 10px; 
                                font-size: 9pt; 
                                font-weight: 700;
                                -webkit-print-color-adjust: exact;
                                color-adjust: exact;
                            }
                            
                            .cv-simple-list ul { margin: 0; padding-left: 20px; }
                            .cv-simple-list li { margin-bottom: 4px; font-size: 10pt; color: #000; line-height: 1.4; }
                        </style>
                    </head>
                    <body>
                        ${cvContent}
                    </body>
                    </html>
                `);
                
                printWindow.document.close();
                
                setTimeout(() => {
                    printWindow.focus();
                    printWindow.print();
                    setTimeout(() => printWindow.close(), 1000);
                }, 1500);
                
                showMessage('success', '💾 Téléchargement PDF en cours... Fenêtre d\'impression ouverte.');
                
            } catch (error) {
                showMessage('error', 'Erreur téléchargement : ' + error.message);
            }
        }

        function printCV() {
            window.print();
        }

        function resetAll() {
            if (confirm('🗑️ Êtes-vous sûr de vouloir tout effacer et recommencer ?\n\nToutes les données seront perdues.')) {
                // Vider tous les champs
                cvTextInput.value = '';
                document.getElementById('jobTitle').value = '';
                document.getElementById('profileCode').value = '';
                document.getElementById('availability').value = '';
                document.getElementById('mobility').value = '';
                document.getElementById('salary').value = '';
                document.getElementById('remark').value = '';
                document.getElementById('soufyaneRemark').value = '';
                
                // Reset l'aperçu
                document.getElementById('previewJobTitle').textContent = 'Poste à définir';
                document.getElementById('previewProfileCode').textContent = 'PROFIL XXX';
                document.getElementById('previewContent').innerHTML = `
                    <div style="text-align: center; color: #666; padding: 60px 30px;">
                        <p style="font-size: 16pt; margin-bottom: 20px; font-weight: 700;">✨ Interface réinitialisée</p>
                        <p style="font-size: 14pt; margin-bottom: 15px;">Prêt pour un nouveau CV premium</p>
                        <p style="font-size: 12pt; color: #999;">Fournissez un CV et cliquez sur "Analyser"</p>
                    </div>
                `;
                
                // Cacher les éléments
                previewActions.classList.remove('show');
                internalInfo.style.display = 'none';
                
                // Reset des données
                currentCvData = null;
                isRealTimeEnabled = false;
                processingMode = 'text';
                
                // Nettoyer le stockage
                Storage.remove('cv_anonymizer_data');
                Storage.remove('cv_anonymizer_generated');
                
                // Reset upload zone
                uploadZone.querySelector('.upload-text').textContent = 'Glissez-déposez votre CV ou sélectionnez une option';
                
                // Reset compteur
                updateCharCounter();
                
                // Cacher messages
                hideMessages();
                
                showMessage('success', '✅ Interface réinitialisée ! Prêt pour un nouveau CV.');
            }
        }

        // Utility functions améliorées
        function showLoading(message = 'Chargement...', subtext = '') {
            document.querySelector('.loading-text').textContent = message;
            document.querySelector('.loading-subtext').textContent = subtext;
            loadingOverlay.style.display = 'flex';
            generateBtn.disabled = true;
        }

        function updateLoadingText(text) {
            document.querySelector('.loading-subtext').textContent = text;
        }

        function hideLoading() {
            loadingOverlay.style.display = 'none';
            generateBtn.disabled = false;
        }

        function showMessage(type, message) {
            hideMessages();
            let element;
            if (type === 'success') element = successMessage;
            else if (type === 'error') element = errorMessage;
            else if (type === 'info') element = apiKeyMessage;
            
            if (element) {
                element.textContent = message;
                element.classList.add('show');
                setTimeout(hideMessages, type === 'error' ? 10000 : 6000);
            }
        }

        function hideMessages() {
            successMessage.classList.remove('show');
            errorMessage.classList.remove('show');
            apiKeyMessage.classList.remove('show');
        }

        function showApiKeyPrompt() {
            const apiKey = prompt(`🔑 Configuration clé API OpenRouter

1. Créez un compte gratuit sur openrouter.ai
2. Obtenez votre clé API dans le dashboard  
3. Collez votre clé ici (format: sk-or-xxxxx)

💰 Coût approximatif: 2-5€ pour 100 CV analysés
🔒 Votre clé est stockée localement et sécurisée

Votre clé API :`);
            
            if (apiKey && apiKey.startsWith('sk-or-')) {
                AI_CONFIG.apiKey = apiKey;
                Storage.save('openrouter_api_key', apiKey);
                showMessage('success', '✅ Clé API configurée avec succès ! L\'outil premium est prêt.');
            } else if (apiKey) {
                showMessage('error', '❌ Format invalide. La clé doit commencer par sk-or-');
            }
        }

        function loadSavedData() {
            const saved = Storage.load('cv_anonymizer_data');
            if (saved) {
                try {
                    cvTextInput.value = saved.cvText || '';
                    document.getElementById('jobTitle').value = saved.jobTitle || '';
                    document.getElementById('profileCode').value = saved.profileCode || '';
                    document.getElementById('availability').value = saved.availability || '';
                    document.getElementById('mobility').value = saved.mobility || '';
                    document.getElementById('salary').value = saved.salary || '';
                    document.getElementById('remark').value = saved.remark || '';
                    document.getElementById('soufyaneRemark').value = saved.soufyaneRemark || '';
                    processingMode = saved.processingMode || 'text';
                    updateCharCounter();
                    
                    // Charger le CV généré s'il existe
                    const savedCV = Storage.load('cv_anonymizer_generated');
                    if (savedCV) {
                        currentCvData = savedCV;
                        displayAnonymousCV();
                        displayInternalInfo();
                    }
                } catch (e) {
                    console.log('Erreur chargement données sauvegardées');
                }
            }
        }

        // Initialisation COMPLÈTE
        document.addEventListener('DOMContentLoaded', () => {
            console.log('🚀 CV Anonymizer TAFINAR Premium - Initialisation...');
            
            // Charger la clé API sauvegardée
            const savedApiKey = Storage.load('openrouter_api_key');
            if (savedApiKey) {
                AI_CONFIG.apiKey = savedApiKey;
                console.log('✅ Clé API chargée');
            }

            // Charger les données sauvegardées
            loadSavedData();
            
            // Initialiser le compteur
            updateCharCounter();
            
            // Message de bienvenue
            setTimeout(() => {
                if (!AI_CONFIG.apiKey) {
                    showMessage('info', '🔑 Configurez votre clé API pour commencer');
                }
            }, 2000);
            
            console.log('✅ CV Anonymizer Premium initialisé');
        });

        // Styles d'impression intégrés
        const printStyles = document.createElement('style');
        printStyles.textContent = `
            @media print {
                body * { visibility: hidden; }
                .cv-preview, .cv-preview * { visibility: visible; }
                .cv-preview { 
                    position: absolute; 
                    left: 0; 
                    top: 0; 
                    width: 100%; 
                    height: 100%;
                    border: none !important;
                    border-radius: 0 !important;
                    box-shadow: none !important;
                    max-width: none;
                }
                .cv-container {
                    width: 210mm;
                    min-height: 297mm;
                    margin: 0;
                    box-shadow: none;
                    font-size: 11pt;
                }
                .cv-header { border-radius: 0; page-break-inside: avoid; }
                .cv-section { page-break-inside: avoid; }
                .cv-section-title { page-break-after: avoid; }
                .cv-experience { page-break-inside: avoid; }
                .cv-competence-category { page-break-inside: avoid; }
                .cv-formation-item { page-break-inside: avoid; }
            }
        `;
        document.head.appendChild(printStyles);
    </script>
</body>
</html>
